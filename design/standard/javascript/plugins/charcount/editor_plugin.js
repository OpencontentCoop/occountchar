!function(){tinymce.create("tinymce.plugins.CharCount",{block:0,id:null,countre:null,cleanre:null,init:function(n,t){function e(n){return n!==c&&(n===r.ENTER||n===r.SPACEBAR||n===r.DELETE)}function o(n){return n===r.DELETE||n===r.BACKSPACE}var a=this,c=0,r=tinymce.VK;a.countre=n.getParam("charcount_countregex",/[\w\u2019\'-]+/g),a.cleanre=n.getParam("charcount_cleanregex",/[.(),;:!?%#$?\'\"_+=\\\/-]*/g),a.update_rate=n.getParam("charcount_update_rate",1e3),a.update_on_delete=n.getParam("charcount_update_on_delete",!0),a.id=n.id+"-char-count",n.onPostRender.add(function(n,t){var e,o;(o=n.getParam("charcount_target_id"))?tinymce.DOM.add(o,"span",{},'<span id="'+a.id+'">0</span>'):(e=tinymce.DOM.get(n.id+"_path_row"))&&tinymce.DOM.add(e.parentNode,"div",{style:"float: right"},n.getLang("charcount.chars","Chars: ")+'<span id="'+a.id+'">0</span>')}),n.onInit.add(function(n){n.selection.onSetContent.add(function(){a._count(n)}),a._count(n)}),n.onSetContent.add(function(n){a._count(n)}),n.onKeyUp.add(function(n,t){(e(t.keyCode)||a.update_on_delete&&o(t.keyCode))&&a._count(n),c=t.keyCode})},_getCount:function(n){var t=0,e=n.getContent({format:"raw"});if(e){var o=(e=(e=(e=(e=e.replace(/\.\.\./g," ")).replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," ")).replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," ")).replace(this.cleanre,"")).match(this.countre);if(o)for(var a=o.length,c=0;c<a;c++)t+=o[c].length}return t},_count:function(n){var t=this;t.block||(t.block=1,setTimeout(function(){if(!n.destroyed){var e=t._getCount(n);tinymce.DOM.setHTML(t.id,e.toString()),setTimeout(function(){t.block=0},t.update_rate)}},1))},getInfo:function(){return{longname:"Char Count plugin",author:"OpenContent Scarl",authorurl:"http://www.opencontent.it",infourl:"http://www.opencontent.it/TinyMCE:Plugins/charcount",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("charcount",tinymce.plugins.CharCount)}();
